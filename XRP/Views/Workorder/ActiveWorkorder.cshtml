@model XRP.Models.Paged_ssmtbl_WorkorderModel
@using XRP.Global;
@{
    ViewBag.Title = "ActiveWorkorder";
    ViewBag.Active = "Marketing";
    Layout = "~/Views/Shared/_DesignLayout.cshtml";
}
<style>
    .btnGenerateWO {
        position: absolute;
        bottom: 25px;
        right: 20px;
    }
    /*.btnShowWO{
        position: absolute;
        bottom: 25px;
        left: 20px;
    }*/
    .btnGenerateCuttingSlip {
        position: absolute;
        bottom: 25px;
        left: 20px;
    }
</style>
<link rel="stylesheet" href="~/assets/css/app.css">
@using (Html.BeginForm("AllPO", "Workorder", FormMethod.Get, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary(true)

    <input type="hidden" id="woPOID" />
    <input type="hidden" id="hdnGrossWeight" />

    @*<div class="btn btn-warning btn-lg toast-action"
             data-title="Alert !"
             data-message="Plan Qty must be less than Balance Qty"
             data-type="success"
             data-position-class="toast-bottom-right" style="display:none" id="divAlert" align="center">

        </div>*@
    <fieldset>
        <style>
            .icon:hover, .trDelivery:hover {
                cursor: pointer;
            }

            /*.table-wrapper-scroll-y {
                display: block;
                max-height: 600px;
                overflow-y: auto;
                -ms-overflow-style: -ms-autohiding-scrollbar;
            }*/
        </style>
        <link href="~/Content/Validations/jquery-ui.css" rel="stylesheet" />
        <!-- PAGE TITLE -->


        <div class="row">
            <div class="col-md-12">

                <div class="panel panel-default">


                    <div class="container-fluid animatedParent animateOnce p-0">
                        <div class="animated fadeInUpShort">
                            <div class="row no-gutters">
                                <div class="col-md-3 white sticky" style="height:auto">
                                    <div class="sticky white">
                                        <ul class="nav nav-tabs nav-material">
                                            <li class="nav-item">
                                                <a class="nav-link p-3 active show" id="w2--tab1" data-toggle="tab" href="#w2-tab1" style="height:auto">
                                                    <input type="text" class="" id="txt_search" style="display:none;" /><br />
                                                     <i class="icon icon-document s-18 text-success"></i>Active Workorders
                                                  
                                                    <i class="icon-search" onclick="search();"></i>
                                                </a>
                                            </li>

                                        </ul>
                                    </div>

                                    <div class="slimScroll" style="position:relative;overflow:hidden;height:initial">
                                        <div class="slimScroll" style="">
                                            <div class="tab-content " id="v-pills-tabContent">
                                                <div class="tab-pane fade show active slimScroll" id="w2-tab1" role="tabpanel"
                                                     aria-labelledby="w2-tab1">
                                                    <ul class="list-unstyled trDelivery" id="ullslistbind">

                                                        @foreach (var data in Model.ssmtbl_WorkorderModel)
                                                        {


                                                            <li style="display:none" class="WoNo"><input type="hidden" value="@data.WorkorderNo" id="hdnwono" /></li>

                                                            <li class="media p-3 b-b has-hover liPOS" onclick="fetchWO(@data.WorkorderID)">

                                                                <div type="hidden" value="@data.WorkorderID" class="WorkorderID" />
                                                                <div>
                                                                    <div class="avatar avatar-md mr-3 mt-1 float-left">
                                                                        <img src="~/NewCssAndTheme/img/imageWOs.jpg" class="s-128" />
                                                                       
                                                                    </div>
                                                                    <div class="media-body text-truncate">

                                                                        <h6 class="mt-0 mb-1 font-weight-normal">@data.WorkorderNo </h6>


                                                                        <small title="Plan Qty"> @data.PlanQty&nbsp;</small>
                                                                        <small title="Created Date"> | &nbsp; @data.CreatedDate.Date.ToString("dd-MM-yyyy")&nbsp;</small>
                                                                        <small title="Target Date"> | &nbsp;@data.TargetDate.Date.ToString("dd-MM-yyyy")</small>
                                                                    </div>

                                                                </div>
                                                            </li>

                                                        }
                                                    </ul>

                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>


                                <div class="col-md-6 tab-pane animated fadeInUpShort" id="PODetailsDiv" style="height:auto">

                                    <div class="m-md-1">

                                        <div class="card b-0 m-2">
                                            <div class="card-body" style="height:600px">
                                                <div data-target="#message1">
                                                    <span class="r-3 badge badge-primary align-self-end float-right" id="lblNatureOfWork" title="Nature Of Work">Nature Of Work</span>
                                                    <br /><br />


                                                    <div class="media">

                                                        <div class="mr-2 float-left">
                                                            <img src="~/NewCssAndTheme/img/imageWOs.jpg" class="s-48" style="height:100px;" />
                                                            @*<i class="icon icon-note-list text-light-blue s-48"></i>*@
                                                        </div>
                                                        <div class="media-body">

                                                            <h6 class="mt-0 mb-1 font-weight-normal" id="lblcustomerName"><label title="Customer Name"></label></h6>



                                                            <span style="padding-bottom:0">
                                                                <label>PO #</label>  <strong id="lblpono" class="Label"></strong> &nbsp;
                                                                <label>| &nbsp; Workorder #</label>  <strong id="lblWorkorderno1" class="Label"></strong> &nbsp;
                                                                <label> | &nbsp;Plan Qty :</label> &nbsp;<label id="lblPOQty" class="Label" title="Plan Qty"></label>
                                                                <br />

                                                            </span>
                                                            <small>Created Date:&nbsp;</small> <small id="lblApprovalDate"></small>
                                                            <small>| &nbsp;Target Date:&nbsp;</small><small id="lblTargetDate"></small>
                                                            <div class="collapse my-3 show" id="message1">
                                                                <div>
                                                                    <p style="line-height: 1">
                                                                        Die :&nbsp;<label id="lblDieNo" class="Label"></label><br />
                                                                        Part Name:&nbsp;<label id="lblPartName" class="Label"></label><br />
                                                                        Raw Material : &nbsp;<label id="lblrawMaterial" class="Label"></label>
                                                                        <br>
                                                                        Section : <label id="lblSection" class="Label"></label><br>
                                                                        Condition Of Supply : &nbsp;<label id="lblCondOfSupply" class="Label"></label><br />
                                                                        Cut Weight : &nbsp;<label id="lblCutwt" class="Label"></label><br />
                                                                        Operations Involved  : &nbsp;<label id="lblOpsinvolved" class="Label"></label><br />
                                                                        Heat Treatment : &nbsp;<label id="lblHeatTreatment" title="Heat Treatment" class="Label"></label><br />
                                                                        Hardness : &nbsp;<label id="lblHardnessMin" title="Hardness Min" class="Label"></label>&nbsp;&nbsp;- &nbsp;<label id="lblHardnessMax" title="Hardness Max" class="Label"></label>
                                                                        &nbsp;<label id="lblHardnessUnits" title="Hardness Unit" class="Label"></label><br />


                                                                    </p>

                                                                </div>

                                                            </div>

                                                        </div>


                                                    </div>

                                                   
                                                </div>

                                            </div>

                                        </div>

                                    </div>

                                </div>

                                <div class="col-md-3 tab-pane animated fadeInUpShort" id="WODetailsDiv" style="display:none; overflow : hidden ; height : 900px ;" data-height="900">
                                    <div class="m-md-1">
                                        <!--Message Start-->
                                        <div class="card b-0 m-2">
                                            <div class="card-body" style="height:600px">

                                                <div class="form-row">
                                                    <div class="form-group col-12 m-0 float-right">
                                                        <span class="col-form-label s-12 float-right">
                                                            WO # <strong id="lblWorkorderno" class="Label">  </strong>
                                                        </span>
                                                    </div>

                                                    <div class="form-group col-12 m-0">
                                                        <h6 class="mt-0 font-weight-normal" id="lblcustomerName1"><label title="Customer Name"></label></h6>

                                                        <span>
                                                            <label>PO # </label>&nbsp;<strong id="lblpono1" class="Label"></strong>
                                                        </span>


                                                        <br /><br />
                                                        <div>
                                                            <p style="line-height: 1">
                                                                Die #&nbsp; <label id="lblDieNo1" class="Label"></label><br />
                                                                PO Quantity : &nbsp;<label id="txtPoQty" class="Label"></label><br />
                                                                Section : &nbsp;<label id="lblSection1" class="Label"></label><br />
                                                                Cut Weight :&nbsp; <label id="lblCutwt1" class="Label"></label> <br />


                                                                Hammer Required : &nbsp; <label id="lblHammerReq" class="Label"></label>
                                                                <br />
                                                                Cut Length : &nbsp; <label id="lblCutLength" class="Label"></label>
                                                                <br />
                                                                Heat Code : &nbsp; <label id="lblHeatCode" class="Label">Heat Code</label>
                                                            </p>

                                                        </div>
                                                        @*<div class="form-row">

                                                            <div class="form-group col-12 m-0" id="divbtnGenerateReq">
                                                                <i class="float-left"><label style="font-size:11px">RM Availability :</label>&nbsp;<label id="RMAvailability" style="font-size:11px" class="Label"></label></i>
                                                                <button type="button" value="Save" class="btn btn-success btn-xs float-right" id="btnGenerateReq" href="#modalGenerateRequisition" data-toggle="modal" data-target="#modalGenerateRequisition" title="Generate Raw Material Requisition"><i class="icon-input"></i>  </button>

                                                            </div>


                                                            <div class="form-group col-12 m-0" id="divbtnGenerateDieReq">
                                                                <i class="float-left"><label style="font-size:11px">Die Availability :</label>&nbsp;<label id="DieAvailability" style="font-size:11px" class="Label"></label></i>
                                                                <button type="button" value="Save" class="btn btn-primary btn-xs float-right" id="btnGenerateDieReq" href="#modalGenerateDieRequisition" data-toggle="modal" data-target="#modalGenerateDieRequisition" title="Generate Die Requisition"><i class="icon-input"></i>  </button>

                                                            </div>
                                                        </div>*@

                                                        <div class="form-row">

                                                            <div class="form-group col-6 m-0">
                                                                <label for="txtTargetDate" class="col-form-label s-12">  Target Date:</label>
                                                                <input id="txtTargetDate" class="date-time-picker form-control r-0 light s-12 " type="text" readonly="readonly">
                                                                <i class="float-left"><label style="font-size:11px">Dispatched Qty:</label>&nbsp;<label id="lblTotalDispatchQty" style="font-size:11px" class="Label"></label></i>
                                                            </div>

                                                            <div class="form-group col-6 m-0">
                                                                <label for="txtPlanQty" class="col-form-label s-12">Plan Qty:</label>

                                                                <input id="txtPlanQty" class="form-control r-0 light s-12 Float-Number" type="text" oninput="isGreaterThanPOQty()" readonly>
                                                                <i class="float-right"><label style="font-size:11px">Balance Qty:</label>&nbsp;<label id="lblBalancedQty" style="font-size:11px" class="Label"></label></i>

                                                            </div>


                                                        </div>


                                                    </div>

                                                </div>

                                            </div>
                                        </div>




                                    </div>
                                </div>
                            </div>

                            @* Modal POP Up *@
                            <div class="modal fade" id="modalGenerateRequisition" tabindex="-1" role="dialog" aria-labelledby="modalGenerateRequisition" aria-hidden="true" style="display:none;">
                                <div class="modal-dialog modal-md" role="document">
                                    <div class="modal-content b-0">
                                        <div class="modal-header r-0 bg-primary">
                                            <h6 class="modal-title text-white" id="exampleModalLabel">Raw Material Requisition</h6>
                                            <a href="#" data-dismiss="modal" aria-label="Close" class="paper-nav-toggle paper-nav-white active"><i></i></a>
                                        </div>
                                        <div class="modal-body no-p no-b">
                                            <div class="card-body">
                                                <form class="needs-validation" novalidate="">
                                                    <div class="form-row">
                                                        <div class="col-md-4 mb-3">
                                                            <label for="validationCustom01">Requisition Type</label>
                                                            <input type="text" class="form-control r-0 light s-12" id="txtRequisitionType" value="Raw Material" readonly="readonly">


                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label for="validationCustom02">Customer name</label>
                                                            <input type="text" class="form-control r-0 light s-12" id="txtCustomerName" readonly="readonly">

                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label for="validationCustomUsername">Part Name</label>
                                                            <div class="input-group">

                                                                <input type="text" class="form-control r-0 light s-12" id="txtRMPartName" readonly="readonly">

                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">

                                                        <div class="col-md-4 mb-3">
                                                            <label for="validationCustom04">Raw Material</label>
                                                            <input type="text" class="form-control r-0 light s-12" id="txtRMRawMaterial" readonly="readonly">

                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label for="validationCustom05">Section</label>
                                                            <input type="text" class="form-control r-0 light s-12" id="txtRMSection" readonly="readonly">

                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label for="validationCustom03">Quantity (Pieces)</label>
                                                            <input type="text" class="form-control r-0 light s-12" id="txtRMQuantity">

                                                        </div>
                                                    </div>
                                                    @*<div class="form-row">
                                                            <div class="col-md-12 mb-3">
                                                                <label for="validationCustom03">Part Description</label>

                                                                <textarea id="txtPartDescription" class="form-control r-0 light s-12 "></textarea>
                                                            </div>
                                                        </div>*@
                                                    <div class="form-row">
                                                        <div class="col-md-12 mb-3">
                                                            <label for="validationCustom03">Remark</label>

                                                            <textarea id="txtRMRemark" class="form-control r-0 light s-12 "></textarea>
                                                        </div>
                                                    </div>

                                                </form>


                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-primary l-s-1 s-12 text-uppercase" onclick="SendRequisition();" type="button">
                                                Send
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal fade" id="modalGenerateDieRequisition" tabindex="-1" role="dialog" aria-labelledby="modalGenerateDieRequisition" aria-hidden="true" style="display:none;">
                                <div class="modal-dialog modal-md" role="document">
                                    <div class="modal-content b-0">
                                        <div class="modal-header r-0 bg-primary">
                                            <h6 class="modal-title text-white" id="exampleModalLabel">Die Requisition</h6>
                                            <a href="#" data-dismiss="modal" aria-label="Close" class="paper-nav-toggle paper-nav-white active"><i></i></a>
                                        </div>
                                        <div class="modal-body no-p no-b">
                                            <div class="card-body">
                                                <form class="needs-validation" novalidate="">
                                                    @*<div class="form-row">
                                                            <div class="col-md-4 mb-3">
                                                                <label for="validationCustom01">Requisition Type</label>
                                                                <input type="text" class="form-control r-0 light s-12" id="txtRequisitionType" value="Raw Material" readonly="readonly">


                                                            </div>
                                                            <div class="col-md-4 mb-3">
                                                                <label for="validationCustom02">Customer name</label>
                                                                <input type="text" class="form-control r-0 light s-12" id="txtCustomerName">

                                                            </div>
                                                            <div class="col-md-4 mb-3">
                                                                <label for="validationCustomUsername">Part Name</label>
                                                                <div class="input-group">

                                                                    <input type="text" class="form-control r-0 light s-12" id="txtPartName">

                                                                </div>
                                                            </div>
                                                        </div>
                                                        <div class="form-row">

                                                            <div class="col-md-4 mb-3">
                                                                <label for="validationCustom04">Raw Material</label>
                                                                <input type="text" class="form-control r-0 light s-12" id="txtRawMaterial">

                                                            </div>
                                                            <div class="col-md-4 mb-3">
                                                                <label for="validationCustom05">Section</label>
                                                                <input type="text" class="form-control r-0 light s-12" id="txtSection">

                                                            </div>
                                                            <div class="col-md-4 mb-3">
                                                                <label for="validationCustom03">Quantity</label>
                                                                <input type="text" class="form-control r-0 light s-12" id="txtQuantity">

                                                            </div>
                                                        </div>*@
                                                    <div class="form-row">
                                                        <div class="col-md-12 mb-3">
                                                            <label for="txtDieDescription">Description</label>

                                                            <textarea id="txtDieDescription" class="form-control r-0 light s-12 "></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="col-md-12 mb-3">
                                                            <label for="txtDieRemark">Remark</label>

                                                            <textarea id="txtDieRemark" class="form-control r-0 light s-12 "></textarea>
                                                        </div>
                                                    </div>

                                                </form>


                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-primary l-s-1 s-12 text-uppercase" onclick="SendDieRequisition();">
                                                Send
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="modal fade" id="modalCuttingSlip" tabindex="-1" role="dialog" aria-labelledby="modalCuttingSlip" aria-hidden="true" style="display:none;">
                                <div class="modal-dialog modal-md" role="document">
                                    <div class="modal-content b-0">
                                        <div class="modal-header r-0 bg-primary">
                                            <h6 class="modal-title text-white" id="exampleModalLabel">
                                                Cutting Slip
                                                <span class="float-right" style="color:white; padding-right:50px;">
                                                    # <strong id="lblCuttingSlipNo" style="color:white">
                                                        CS-00001
                                                    </strong>
                                                </span>
                                            </h6>

                                            <a href="#" data-dismiss="modal" aria-label="Close" class="paper-nav-toggle paper-nav-white active"><i></i></a>
                                        </div>
                                        <div class="modal-body no-p no-b">
                                            <div class="card-body">
                                                <div class="form-group col-12 m-0">
                                                    @*<span class="float-right">
                                                            Cutting Slip # <strong id="lblCuttingSlipNo">
                                                            CS-00001
                                                            </strong>
                                                        </span><br />*@
                                                    <div>

                                                        <span class="float-right">
                                                            WorkOrder # <strong id="lblCutWorkorderno"></strong>
                                                        </span><br />
                                                        <div class="float-left">
                                                            <img class="d-flex mr-3 height-50" src="~/assets/img/dummy/u1.png" alt="Generic placeholder image">
                                                        </div>
                                                        <div class="media-body text-truncate">


                                                            <span><strong><label id="lblCutcustomerName"></label></strong></span>
                                                            <br>
                                                            <small style="color:grey" title="PO No"><label id="lblCutPONo">PO501 </label> &nbsp;</small>
                                                            <small style="color:grey" title="Section">| &nbsp;<label id="lblCutSection">75 Dia</label>&nbsp;</small>
                                                            <small style="color:grey" title="Cut Weight"> | &nbsp; <label id="lblCutCTWt">75</label> &nbsp;</small>
                                                            <small style="color:grey" title="Die No"> | &nbsp; <label id="lblCutDieNo">369852</label> &nbsp;</small>
                                                            <br />
                                                            <small style="color:grey" title="PO Quantity"> <label id="lblCutPOQty">100</label> &nbsp;</small>
                                                            <small style="color:grey" title="Hammer Required"> | &nbsp; <label id="lblCutHammerReq">Hammer Req</label> &nbsp;</small>
                                                            <small style="color:grey" title="Cut Length"> | &nbsp; <label id="lblCutCutLength">Cut Length</label> &nbsp;</small>
                                                            <small style="color:grey" title="Heat Code"> | &nbsp; <label id="lblCutHeatCode">Heat Code</label> &nbsp;</small>
                                                            <small style="color:grey" title="RM Grade"> | &nbsp; <label id="lblCutRMGrade">RM Grade</label> &nbsp;</small>
                                                        </div>

                                                    </div>

                                                </div>
                                                <br />
                                                @*<form class="needs-validation" novalidate="">*@
                                                @*<div class="form-row">
                                                        <div class="col-md-3 mb-3">
                                                            <label for="lblCutRMGrade">RM Grade:</label>
                                                            <label id="lblCutRMGrade"></label>


                                                        </div>
                                                        <div class="col-md-3 mb-3">
                                                            <label for="lblCutSection">Section:</label>
                                                            <label id="lblCutSection"></label>

                                                        </div>
                                                        <div class="col-md-3 mb-3">
                                                            <label for="lblCutInternalCutWt" >Cut Weight:</label>
                                                            <label id="lblCutInternalCutWt"></label>

                                                        </div>

                                                        <div class="col-md-3 mb-3">
                                                            <label for="lblCutlength">Cut Length:</label>

                                                            <label id="lblCutlength"></label>



                                                        </div>
                                                    </div>*@
                                                <div class="form-row">
                                                    <div class="col-md-6 mb-3">
                                                        <label for="txtCutQuantity">Quantity:</label>
                                                        <input type="text" class="form-control r-0 light s-12" id="txtCutQuantity" oninput="calculateTotalWt()">

                                                    </div>
                                                    <div class="col-md-6 mb-3">
                                                        <label for="txtCutTotalWt">Total Weight (Kg):</label>
                                                        <input type="text" class="Label" id="txtCutTotalWt" readonly="readonly" style="border:none">

                                                    </div>
                                                    @*<div class="col-md-4 mb-3">
                                                            <label for="validationCustom05">Section</label>
                                                            <input type="text" class="form-control r-0 light s-12" id="txtSection">

                                                        </div>
                                                        <div class="col-md-4 mb-3">
                                                            <label for="validationCustom03">Quantity</label>
                                                            <input type="text" class="form-control r-0 light s-12" id="txtQuantity">

                                                        </div>*@
                                                </div>
                                                @*<div class="form-row">
                                                        <div class="col-md-12 mb-3">
                                                            <label for="validationCustom03">Part Description</label>

                                                            <textarea id="txtPartDescription" class="form-control r-0 light s-12 "></textarea>
                                                        </div>
                                                    </div>
                                                    <div class="form-row">
                                                        <div class="col-md-12 mb-3">
                                                            <label for="validationCustom03">Remark</label>

                                                            <textarea id="txtRemark" class="form-control r-0 light s-12 "></textarea>
                                                        </div>
                                                    </div>*@

                                                @*</form>*@


                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            @*<button class="btn btn-primary l-s-1 s-12 text-uppercase" onclick="generateCuttingSlip();">
                                                    Send
                                                </button>*@
                                            <button class="btn btn-primary l-s-1 s-12 text-uppercase">
                                                Send
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </fieldset>

    <script type="text/javascript" src="~/Scripts/jquery-1.10.2.js"></script>
    <script src="~/Scripts/jquery-1.10.2.min.js"></script>
    <script src="~/Content/Validations/JqueryUi.js"></script>

    <script type="text/javascript">
        var $j = jQuery.noConflict(true);
    </script>
    <script type="text/javascript">
        $(document).ready(function () {
            $("#PODetailsDiv").hide();
            $("#WODetailsDiv").hide();
            document.body.style.overflow = 'hidden';
            $(function () {
                $('.date-time-picker').datetimepicker({
                    format: 'd/m/Y',
                    timepicker: false,

                });
            });
        });
    </script>
    <script>
        function closeDieModal() {

            $('#modalGenerateDieRequisition').modal('hide');
        }
        function closePopup() {

            $('#modalGenerateRequisition').modal('hide');

        }
    </script>

    @*<script>
            function isGreaterThanPOQty() {
                var poQty = $("#txtPoQty").text();
                var planQty = parseFloat($("#txtPlanQty").val());
                var dispatchQty = parseFloat($("#lblTotalDispatchQty").text());
                var balanceQty = parseFloat($("#lblBalancedQty").text());
                if (poQty == balanceQty) {
                    balanceQty = 0;
                } else {
                    balanceQty = $("#lblBalancedQty").text();
                }
                var totalPlanableQty = poQty - (dispatchQty + balanceQty);
                //alert(totalPlanableQty);
              //  if (planQty > totalPlanableQty) {
                if (planQty > balanceQty) {
                    //alert("Plan Qty must be less than Balance Qty");
                    $("#divAlert").click();
                    $("#txtPlanQty").val("");
                    document.getElementById("txtPlanQty").style.borderColor = "red";
                    return false;
                } else {
                    document.getElementById("txtPlanQty").style.borderColor = "";
                }
            }
        </script>*@
    <script>
        function SendRequisition() {
            var reqType = $("#txtRequisitionType").val();
            var customerName = $("#txtCustomerName").val();
            var partName = $("#txtRMPartName").val();
            var rawMaterial = $("#txtRMRawMaterial").val();
            var section = $("#txtRMSection").val();
            var quantity = $("#txtRMQuantity").val();
            var DieDescription = "0";
            var partDescription = $("#txtPartDescription").val();
            var workorderNo = $("#hdnwono").val();
            var remark = $("#txtRMRemark").val();
            var GrossWeight = $("#hdnGrossWeight").val();
            var totalWt = quantity * GrossWeight;
            //alert(workorderNo);
            $.ajax
                                         ({
                                             type: "POST",
                                             url: "../Workorder/SendRequisition",
                                             data: JSON.stringify({
                                                 ReqType: ' ' + reqType + '', CustomerName: ' ' + customerName + '', PartName: ' ' + partName + '', RawMaterial: ' ' + rawMaterial + '', TotalWt: '' + totalWt + '',
                                                 Section: ' ' + section + '', Quantity: ' ' + quantity + '', DieDescription: '' + DieDescription + '', PartDescription: ' ' + partDescription + '', WorkorderNo: '' + workorderNo + '', Remark: '' + remark + ''
                                             }),
                                             contentType: "application/json;charset=utf-8",
                                             //dataType: "json",
                                             success: function (rfqid) {

                                                 //$j("#modalGenerateRequisition").closeModal();
                                                 $j("#RMAvailability").text("Requisition Sent");
                                                 $j("#btnGenerateReq").hide();
                                                 insertRequisitionDetails(rfqid, rawMaterial, section, quantity, totalWt);
                                                 // getRawMaterialAvailability(data[0].RawMaterial, data[0].Section);
                                             },
                                             error: function (err) {

                                             }
                                         });
        }
        function insertRequisitionDetails(rfqid, rawMaterial, section, quantity, totalWt) {

            $.ajax
                                       ({
                                           type: "POST",
                                           url: "../Workorder/insertRequisitionDetails",
                                           data: JSON.stringify({
                                               RFQId: ' ' + rfqid + '', RawMaterial: ' ' + rawMaterial + '',
                                               Section: ' ' + section + '', Quantity: ' ' + quantity + '', TotalWt: ' ' + totalWt + ''
                                           }),
                                           contentType: "application/json;charset=utf-8",
                                           //dataType: "json",
                                           success: function (data) {
                                               closePopup();
                                               alert("Requisition Sent Successfully!");
                                           },
                                           error: function (err) {

                                           }
                                       });

        }
        function SendDieRequisition() {
            var dieDescription = $("#txtDieDescription").val();
            var dieRemark = $("#txtDieRemark").val();
            var dieNo = $("#lblDieNo1").text();
            var workorderNo = $("#lblWorkorderno").text();
            $.ajax
                                         ({
                                             type: "POST",
                                             url: "../Workorder/SendDieRequisition",
                                             data: JSON.stringify({
                                                 DieDescription: ' ' + dieDescription + '', DieRemark: ' ' + dieRemark + '',
                                                 WorkorderNo: ' ' + workorderNo + '', DieNo: ' ' + dieNo + ''
                                             }),
                                             contentType: "application/json;charset=utf-8",
                                             //dataType: "json",
                                             success: function (data) {
                                                 $j("#DieAvailability").text("Requisition Sent");
                                                 $j("#btnGenerateDieReq").hide();
                                                 closeDieModal();
                                                 alert(data);

                                                 // getRawMaterialAvailability(data[0].RawMaterial, data[0].Section);
                                             },
                                             error: function (err) {

                                             }
                                         });
        }
    </script>
    <script>
        function closeModal() {
            var targetDate = $("#txtTargetDate").val();
            var planQty = $("#txtPlanQty").val();
            if (targetDate == "") {
                alert("Please select Target Date");
                return false;
            }
            if (planQty == "") {
                alert("Please enter Plan Quantity");
                return false;
            }
            $('#modalCuttingSlip').modal('show');
            $(document).mouseup(function (e) {
                var popup = $("#modalCuttingSlip");

                if (popup.is(e.target) && popup.has(e.target).length == 0) {
                    generatewo();
                }
            });
        }

        function generatewo() {
            var workorderNo = $("#hdnwono").val();
            var customerName = $("#lblcustomerName1").text();
            var poNumber = $("#lblpono1").text();
            var dieNo = $("#lblDieNo1").text();
            var rawMaterial = $("#lblrawMaterial").text();
            var heatcode = $("#txtHeatCode").val();
            var section = $("#lblSection1").text();
            var cutLength = $("#txtCutLength").val();
            var dateOfIssue = $("#txtDateOfIssue").val();
            var targetDate = $("#txtTargetDate").val();
            var hammerNo = $("#lblHammerReq").text();
            var dieSts = $("#txtDieSts").val();
            var dieLife = $("#txtDieLife").val();
            var cutWt = $("#lblCutwt1").text();
            var poQty = $("#txtPoQty").text();
            var productionStartDate = $("#txtProduStartDate").val();
            var planQty = $("#txtPlanQty").val();
            var availableRM = $("#RMAvailability").text();
            if (availableRM == 'No') {
                availableRM = 0;
            } else {
                availableRM = $("#RMAvailability").text();
            }
            var quantity = $("#txtQuantity").val();
            var reqType = $("#txtRequisitionType").val();
            var partName = $("#txtPartName").val();
            var partDescription = $("#txtPartDescription").val();
            var remark = $("#txtRemark").val();
            var woPOID = $("#woPOID").val();
            var cutLength = $("#lblCutLength").text();
            //if (heatcode == "") {
            //    alert("Please enter Heatcode");
            //    return false;
            //}
            //if (cutLength == "") {
            //    alert("Please enter Cut Length");
            //    return false;
            //}
            if (dateOfIssue == "") {
                alert("Please select Date Of Issue");
                return false;
            }
            //if (targetDate == "") {
            //    alert("Please select Target Date");
            //    return false;
            //}
            //if (hammerNo == "") {
            //    alert("Please select Hammer No");
            //    return false;
            //}
            //if (dieSts == "") {
            //    alert("Please enter Die Status");
            //    return false;
            //}
            //if (dieLife == "") {
            //    alert("Please enter Die Life");
            //    return false;
            //}

            //if (productionStartDate == "") {
            //    alert("Please select Production Start Date");
            //    return false;
            //}

            if (planQty == "") {
                alert("Please enter Plan Quantity");
                return false;
            }
            $("#lblCutRMGrade").text(rawMaterial);
            $("#lblCutSection").text(section);
            $("#lblCutInternalCutWt").text(cutWt);
            $("#lblCutlength").text(cutLength);
            $("#txtCutTotalWt").val(cutLength);

            $.ajax({

                type: "POST",
                url: "../Workorder/GenerateWorkorder",
                data: JSON.stringify({
                    workorderNo: ' ' + workorderNo + ' ', customerName: ' ' + customerName + ' ', poNumber: ' ' + poNumber + ' ',
                    dieNo: ' ' + dieNo + ' ', rawMaterial: ' ' + rawMaterial + ' ', heatcode: ' ' + heatcode + ' ', section: ' ' + section + ' ',
                    cutLength: ' ' + cutLength + ' ', dateOfIssue: ' ' + dateOfIssue + ' ', targetDate: ' ' + targetDate + ' ',
                    hammerNo: ' ' + hammerNo + ' ', dieSts: ' ' + dieSts + ' ', dieLife: ' ' + dieLife + ' ', cutWt: ' ' + cutWt + ' ', poQty: ' ' + poQty + ' ', productionStartDate: ' ' + productionStartDate + ' ', planQty: ' ' + planQty + ' ',
                    availableRM: ' ' + availableRM + ' ', quantity: ' ' + quantity + ' ',
                    reqType: ' ' + reqType + ' ', partName: ' ' + partName + ' ', partDescription: ' ' + partDescription + ' ', remark: ' ' + remark + ' ', woPOID: ' ' + woPOID + ' '
                }),
                contentType: "application/json;charset=utf-8",
                //dataType: "json",
                success: function (data) {
                    alert(data);
                    location.href = "../Workorder/AllPO";
                },
                error: function (err) {
                    // alert('Error occured');
                }
            });

        }

    </script>
    <script>
        function generateCuttingSlip() {
            var quantity = $("#txtCutQuantity").val();
            var totalWeight = $("#txtCutTotalWt").text();
            var rmGrade = $("#lblCutRMGrade").text();
            var section = $("#lblCutSection").text();
            var internalCtWt = $("#lblCutInternalCutWt").text();
            var Ctlength = $("#lblCutlength").text();

        }
    </script>
    <script>
        function calculateTotalWt() {
            var qty = parseFloat($("#txtCutQuantity").val());
            var ctwt = parseFloat($("#lblCutCTWt").text());
            var totalWt = qty * ctwt;
            $("#txtCutTotalWt").val(totalWt);
        }
    </script>
    <script>
      
        $(".liPOS").click(function () {

            $(this).addClass("media p-3 b-b has-hover light border-right");
            $(this).siblings().removeClass("media p-3 b-b has-hover light border-right");
            $(this).siblings().addClass("media p-3 b-b has-hover");
        });
        function fetchWO(woID) {


            var wono = $("#hdnwono").val();
            $("#PODetailsDiv").show();
            $("#WODetailsDiv").show();
            //var customerName = $(el).siblings("div").val();
            $.ajax
                                    ({
                                        type: "POST",
                                        url: "../Workorder/GetWoDataByWOID",
                                        data: JSON.stringify({ WOID: ' ' + woID + '' }),
                                        contentType: "application/json;charset=utf-8",
                                        //dataType: "json",
                                        success: function (data) {
                                            //$j('#txtCustomerName').val(customerName);
                                            console.log(data);
                                            $j("#woPOID").val(woID);
                                            $j('#lblWorkorderno').text(data[0].WorkorderNo);
                                            $j('#lblWorkorderno1').text(data[0].WorkorderNo);
                                            $j('#lblCutWorkorderno').text(data[0].WorkorderNo);
                                            $j('#lblcustomerName').text(data[0].customerName);
                                            $j('#lblcustomerName1').text(data[0].customerName);
                                            $j('#lblCutcustomerName').text(data[0].customerName);
                                            $j('#lblApprovalDate').text(jsondateformatconvert(data[0].CreatedDate));
                                            $j('#lblTargetDate').text(jsondateformatconvert(data[0].TargetDate));
                                            $j('#lblCondOfSupply').text(data[0].FeasibilityConditionSupply1);
                                            //$j('#lblOpsinvolved').text(data[0].ConditionOfSupply);
                                            $j('#lblHeatTreatment').text(data[0].FeasibilityHeattreatment1);
                                            $j('#lblHardnessMin').text(data[0].hardnessmin);
                                            $j('#lblHardnessMax').text(data[0].hardnessmax);
                                            $j('#lblHardnessUnits').text(data[0].hardnessunits);
                                            $j("lblHeatCode").text(data[0].heatcode);

                                            $j('#lblpono').text(data[0].PONumber);
                                            $j('#lblpono1').text(data[0].PONumber);
                                            $j('#lblCutPONo').text(data[0].PONumber);
                                            $j('#txtRMPartName').val(data[0].PartName);
                                            $j('#lblrawMaterial').text(data[0].RawMaterial);
                                            $j('#lblCutRMGrade').text(data[0].RawMaterial);
                                            $j('#txtRMRawMaterial').val(data[0].RawMaterial);
                                            $j('#txtRMSection').val(data[0].Section);
                                            $j('#lblSection').text(data[0].Section);
                                            $j('#lblCutSection').text(data[0].Section);
                                            $j('#lblCutwt').text(data[0].cutweight);
                                            $j('#lblCutCTWt').text(data[0].cutweight);
                                            $j('#lblColorCode').text(data[0].ColorCode);
                                            $j('#lblDieNo').text(data[0].DieNumber);
                                            $j('#lblPartName').text(data[0].PartName);
                                            $j('#lblrawMaterial1').text(data[0].RawMaterial);
                                            $j('#lblSection1').text(data[0].Section);
                                            $j('#lblCutwt1').text(data[0].cutweight);
                                            $j('#lblColorCode1').text(data[0].ColorCode);
                                            $j('#lblDieNo1').text(data[0].DieNo);
                                            $j('#lblCutDieNo').text(data[0].DieNo);
                                            $j('#txtPoQty').text(data[0].QtymentionedinPO);
                                            $j('#lblPOQty').text(data[0].PlanQty);
                                            $j('#txtPlanQty').val(data[0].PlanQty);
                                            $j('#txtTargetDate').val(jsondateformatconvert1(data[0].TargetDate));
                                            $j('#lblCutPOQty').text(data[0].QtymentionedinPO);
                                            var natureOfwork = data[0].NatureOfWork;
                                            if (natureOfwork == '201') {
                                                $j('#lblNatureOfWork').text('Labour job');
                                            }
                                            else if (natureOfwork == '202') {
                                                $j('#lblNatureOfWork').text('With Material');
                                            } else { }
                                            $j("#lblCutLength").text(data[0].cutlength);
                                            $j("#lblCutCutLength").text(data[0].cutlength);
                                            var hammer = data[0].FeasibilityHammerRequired;
                                            if (hammer == '401') {
                                                $j('#lblCutHammerReq').text('3 Tonne');
                                                $j('#lblHammerReq').text('3 Tonne');

                                            }
                                            else if (hammer == '402') {
                                                $j('#lblCutHammerReq').text('1 .25 Tonne');
                                                $j('#lblHammerReq').text('1 .25 Tonne');
                                            }
                                            else if (hammer == '403') {
                                                $j('#lblCutHammerReq').text('1 Tonne');
                                                $j('#lblHammerReq').text('1 Tonne');
                                            }
                                            else if (hammer == '404') {
                                                $j('#lblCutHammerReq').text('Other');
                                                $j('#lblHammerReq').text('Other');
                                            }
                                            else { }
                                            var dieNumber = data[0].DieNo;
                                            getRawMaterialAvailability(data[0].RawMaterial, data[0].Section, data[0].CustomerName, natureOfwork);
                                            getDieAvailability(dieNumber);
                                            getDispatchQty(data[0].poID);
                                            getOpsInvolved(data[0].poID);
                                        },
                                        error: function (err) {

                                        }
                                    });
        }
    </script>

    <script>
        function getWOLIst(poID) {
            $.ajax({
                type: "POST",
                url: "../Workorder/getWOListByPOID",
                data: JSON.stringify({ PoID: '' + poID + '' }),
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    for (var i = 0; i < data.length; i++) {

                        $('#drpWOList').append($("<a class='dropdown-item'>" + data[i].WorkorderNo + "</a>"))

                    }

                }
            });

        }

    </script>
    <script>

        function getOpsInvolved(poID) {

            $.ajax({

                type: "POST",
                url: "../Workorder/getOpsInvolved",
                data: JSON.stringify({ PoID: '' + poID + '' }),
                contentType: "application/json;charset=utf-8",
                //dataType: "json",
                success: function (data) {
                    var append = new Array();
                    for (var i = 0; i < data.length; i++) {

                        append.push(data[i].operationinvolvedname);

                    }
                    append = append.toString();

                    append = append.replace(/,/g, ", ");
                    $j("#lblOpsinvolved").text(append);
                }
            });

        }
    </script>
    <script>
        function getDispatchQty(poID) {
            $("#woPOID").val(poID);
            $.ajax({

                type: "POST",
                url: "../Workorder/getDispatchQty",
                data: JSON.stringify({ PoID: '' + poID + '' }),
                contentType: "application/json;charset=utf-8",
                //dataType: "json",
                success: function (data) {
                    $("#lblTotalDispatchQty").text(data[0]);

                    if ((data[1]) != 0) {
                        $("#lblBalancedQty").text(data[1]);
                    } else {
                        $("#lblBalancedQty").text($("#txtPoQty").text());
                    }
                }
            });

        }
    </script>


    <script>
        function getDieAvailability(dieNumber) {
            $.ajax({
                url: "../Workorder/GetDieAvailability",
                type: "POST",
                dataType: "json",
                data: JSON.stringify({ DieNumber: ' ' + dieNumber + '' }),
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (data != '') {
                        $j('#DieAvailability').text('Yes');
                        $j('#btnGenerateDieReq').hide();
                    }
                    else {
                        $j('#DieAvailability').text('No');
                        $j('#btnGenerateDieReq').show();
                    }
                }
            });

        }


        function getRawMaterialAvailability(RawMaterial, Section, CustomerName, natureOfwork) {
            $j.ajax({
                url: "../Workorder/GetRMAvialbility",
                type: "POST",
                dataType: "json",
                data: JSON.stringify({ RawMaterial: '' + RawMaterial + '', Section: ' ' + Section + '' }),
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (data != '0' || natureOfwork != "202") {
                        //$j("#RMAvailability").text('Yes [Available Qty:' + data + ']');
                        $j("#RMAvailability").text(data);
                        $j("#divbtnGenerateReq").hide();
                    } else {
                        $j("#divbtnGenerateReq").show();
                        $j("#RMAvailability").text('No');
                        $j("#txtCustomerName").val(CustomerName);
                        $j("#btn_Modal").prop('disabled', true);
                    }
                }
            });

        }
    </script>
    <script>
        function jsondateformatconvert(jsondate) {
            var MyDate_String_Value = jsondate;
            var value = new Date
            (
            parseInt(MyDate_String_Value.replace(/(^.*\()|([+-].*$)/g, ''))
            );
            var date = value.getDate();
            if (date < 10) {
                date = "0" + date;
            } else {
                date = date;
            }
            var month = value.getMonth() + 1;
            if (month < 10) {
                month = "0" + month;
            } else {
                month = month;
            }
            var year = value.getFullYear();
            var hrs = value.getHours();
            var minutes = value.getMinutes();
            var sec = value.getSeconds();
            var day = value.getDay();

            var days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            var dayName = days[value.getDay()];

            //var d = new Date(dateString);
            //var dayName = d.toString().split(' ')[0];

            var dat = dayName + ", " + date + "-" + month + "-" + year;
            return dat;
        }

        function jsondateformatconvert1(jsondate) {
            var MyDate_String_Value = jsondate;
            var value = new Date
            (
            parseInt(MyDate_String_Value.replace(/(^.*\()|([+-].*$)/g, ''))
            );
            var date = value.getDate();
            if (date < 10) {
                date = "0" + date;
            } else {
                date = date;
            }
            var month = value.getMonth() + 1;
            if (month < 10) {
                month = "0" + month;
            } else {
                month = month;
            }
            var year = value.getFullYear();
            var hrs = value.getHours();
            var minutes = value.getMinutes();
            var sec = value.getSeconds();
            var day = value.getDay();

            var days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            var dayName = days[value.getDay()];

            //var d = new Date(dateString);
            //var dayName = d.toString().split(' ')[0];

            var dat =  date + "-" + month + "-" + year;
            return dat;
        }
    </script>
    <script>
$(document).on("keypress", "input[type=text].Float-Number", function (event) {
        //  $(".Float-Number").keypress(function (event) {
        ///For Positive float
        //if (isNaN(this.value + "" + String.fromCharCode(e.charCode)))
        //    return false;
        $(this).bind("cut copy paste", function (e) {
            e.preventDefault();
        });
        var value = $("#" + this.id).val();
        //    alert(event.which);
        var iKeyCode = (event.which) ? event.which : event.keyCode
        if (iKeyCode != 46 && iKeyCode != 09 && iKeyCode > 31 && (iKeyCode < 48 || iKeyCode > 57)) {
          //  alert("Enter Numbers Only");
            event.preventDefault();
            return false;
        }
        if (event.which < 45 || event.which > 58 || event.which == 47) {
            if (event.which != 8) {
                return false;
                event.preventDefault();
            }
        } // prevent if not number/dot

        if (event.which == 46 && value.indexOf('.') != -1) {
            return false;
            event.preventDefault();
        } // prevent if already dot

        if (event.which == 45 && value.indexOf('-') != -1) {
            return false;
            event.preventDefault();
        } // prevent if already dot

        if (event.which == 45 && value.length > 0) {
            event.preventDefault();
        } // prevent if already -

        return true;


});
function search() {
    $("#txt_search").show();
    var search = $("#txt_search").val();
    if (search != "") {
        searchbyall(search);
    }

}
function searchbyall(search) {
    $.ajax({
        type: "POST",
        url: "../Workorder/searchbyallActiveWO",
        // data: params,
        data: JSON.stringify({ search: ' ' + search + '' }),
        contentType: "application/json;charset=utf-8",
        // dataType: "json",
        success: function (data) {
            $('#ullslistbind').empty();
            var items = [];
            for (var i = 0; i < data.length; i++) {
                var createddate = jsondateformatconvert('' + data[i].CreatedDate + '');
                var targetdate = jsondateformatconvert('' + data[i].TargetDate + '');

                items.push('<li style="display:none" class="WoNo"><input type="hidden" value='+data[i].WorkorderNo+' id="hdnwono" /></li> <li class="media p-3 b-b has-hover liPOS" onclick="fetchWO(' + data[i].WorkorderID + ')"><div type="hidden" value=' + data[i].WorkorderID + ' class="WorkorderID" /> <div><div class="avatar avatar-md mr-3 mt-1 float-left"><img src="../NewCssAndTheme/img/imageWOs.jpg" class="s-128" /></div> <div class="media-body text-truncate">  <h6 class="mt-0 mb-1 font-weight-normal">' + data[i].WorkorderNo + '</h6><small title="Plan Qty">' + data[i].PlanQty + '&nbsp;</small><small title="Created Date"> | &nbsp; ' + createddate + '&nbsp;</small><small title="Target Date"> | &nbsp;' + targetdate + '</small></div></div></li>');

            }
            $('#ullslistbind').append(items.join(''));
        },
        error: function (err) {
            alert('Error occured');

        }
    });
}
function jsondateformatconvert(jsondate) {

    var MyDate_String_Value = jsondate;
    var value = new Date
    (
    parseInt(MyDate_String_Value.replace(/(^.*\()|([+-].*$)/g, ''))
    );
    var date = value.getDate();
    if (date < 10) {
        date = "0" + date;
    } else {
        date = date;
    }
    var month = value.getMonth() + 1;
    if (month < 10) {
        month = "0" + month;
    } else {
        month = month;
    }
    var year = value.getFullYear();
    var hrs = value.getHours();
    var minutes = value.getMinutes();
    var sec = value.getSeconds();
    var day = value.getDay();

    var days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

    var dayName = days[value.getDay()];
    //var monthlist = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUNE', 'JULY', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
    var monthname = [value.getMonth()];
    //var d = new Date(dateString);
    //var dayName = d.toString().split(' ')[0];
    var result = "";
    var dat = date + "-" + month + "-" + year;

    return dat;
}
    </script>
}