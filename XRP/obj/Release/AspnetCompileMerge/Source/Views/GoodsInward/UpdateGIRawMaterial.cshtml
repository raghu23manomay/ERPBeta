@model XRP.Models.ssmtbl_GoodsInwardModel
@using XRP.Global;
@using XRP.Models;
@{
    ViewBag.Title = "Raw Material Goods Inward";
    ViewBag.Active = "Stock";
    ViewBag.Active1 = "Goods Inward";
    Layout = "~/Views/Shared/_DesignLayout.cshtml";
}

<link href="~/Content/Validations/jquery-ui.css" rel="stylesheet" />

@using (Html.BeginForm("UpdateGIRawMaterial", "GoodsInward", FormMethod.Get, new { @class = "form-horizontal", role = "form", enctype = "multipart/form-data" }))
{
    @Html.ValidationSummary(true)
    <header class="blue accent-3 relative">
        <div class="container-fluid text-white">
            <div class="row p-t-b-10 ">
                <div class="col">
                    <h4>
                        <i class="icon-database"></i>
                        GOODS INWARD
                    </h4>
                </div>
            </div>
            <div class="row justify-content-between">
                <ul class="nav nav-material nav-material-white responsive-tab" id="v-pills-tab" role="tablist">
                    <li>
                        <a class="nav-link" href='@Url.Action("AllGoodsInward","GoodsInward")'><i class="icon icon-home2"></i>All Goods Inward</a>

                    </li>
                    @*<li>
                            <a class="nav-link" id="v-pills-buyers-tab" data-toggle="pill" href="#v-pills-buyers" role="tab" aria-controls="v-pills-buyers"><i class="icon icon-face"></i> Buyers</a>
                        </li>
                        <li>
                            <a class="nav-link" id="v-pills-sellers-tab" data-toggle="pill" href="#v-pills-sellers" role="tab" aria-controls="v-pills-sellers"><i class="icon  icon-local_shipping"></i> Sellers</a>
                        </li>*@
                    <li class="float-right">
                        <a class="nav-link active" href='#'><i class="icon icon-plus-circle"></i>Edit Rawmaterial GoodsInward</a>
                    </li>
                </ul>
            </div>
        </div>
    </header>
    @Html.HiddenFor(model => model.inward_type)
    @Html.HiddenFor(model => model.gin_char)
    @Html.HiddenFor(model => model.gin_id)
    <div class="card-body">
        <div class="form-row mt-1">
            <div class="form-group col-4 m-0">
                @Html.LabelFor(model => model.gin_number, new { @class = "Label" })
                @Html.TextBoxFor(model => model.gin_number, null, new { @class = "form-control r-0 light s-12", id = "gin_number", @readonly = "readonly" })
                @Html.ValidationMessageFor(model => model.gin_number, null, new { @class = "alert-danger" })
            </div>
            <div class="form-group col-4 m-0">
                @Html.LabelFor(model => model.vendor_name, new { @class = "Label" })
                @Html.TextBoxFor(model => model.vendor_name, null, new { @class = "form-control r-0 light s-12", id = "vendor_name" })
                @Html.ValidationMessageFor(model => model.vendor_name, null, new { @class = "alert-danger" })
            </div>
            <div class="form-group col-4 m-0">
                @Html.LabelFor(model => model.vendor_po_no, new { @class = "Label" })
                @Html.TextBoxFor(model => model.vendor_po_no, null, new { @class = "form-control r-0 light s-12", id = "vendor_po_no" })
                @Html.ValidationMessageFor(model => model.vendor_po_no, null, new { @class = "alert-danger" })
            </div>

        </div>
        <div class="form-row mt-1">
            <div class="form-group col-4 m-0">
                @Html.LabelFor(model => model.received_from, new { @class = "Label" })
                <label class="btn btn-default">@Html.RadioButtonFor(model => model.received_from, "Customer")Customer</label>
                @Html.ValidationMessageFor(model => model.received_from, null, new { @class = "alert-danger" })
                <label class="btn btn-default">@Html.RadioButtonFor(model => model.received_from, "Supplier")Supplier</label>
                @Html.ValidationMessageFor(model => model.received_from, null, new { @class = "alert-danger" })
            </div>
            <div class="form-group col-4 m-0">
                @Html.LabelFor(model => model.date_of_arrival, new { @class = "Label" })
                @Html.TextBoxFor(model => model.date_of_arrival, "{0:dd-MMM-yyyy}", new { @class = "form-control r-0 light s-12 datepicker", id = "date_of_arrival" })
                @Html.ValidationMessageFor(model => model.date_of_arrival, null, new { @class = "alert-danger" })
            </div>
            <div class="form-group col-4 m-0">
                @Html.LabelFor(model => model.gate_entry_no, new { @class = "Label" })
                @Html.TextBoxFor(model => model.gate_entry_no, null, new { @class = "form-control r-0 light s-12", id = "gate_entry_no" })
                @Html.ValidationMessageFor(model => model.gate_entry_no, null, new { @class = "alert-danger" })
            </div>

        </div>
        <div class="form-row mt-1">
            <div class="form-group col-4 m-0">
                @Html.LabelFor(model => model.last_gate_entry_no, new { @class = "Label" })
                @Html.TextBoxFor(model => model.last_gate_entry_no, null, new { @class = "form-control r-0 light s-12", id = "last_gate_entry_no" })
                @Html.ValidationMessageFor(model => model.last_gate_entry_no, null, new { @class = "alert-danger" })
            </div>
            <div class="form-group col-4 m-0">
                @Html.LabelFor(model => model.challan_no, new { @class = "Label" })
                @Html.TextBoxFor(model => model.challan_no, null, new { @class = "form-control r-0 light s-12", id = "challan_no" })
                @Html.ValidationMessageFor(model => model.challan_no, null, new { @class = "alert-danger" })
            </div>
            <div class="form-group col-4 m-0">
                @Html.LabelFor(model => model.customer_name, new { @class = "Label" })
                @Html.TextBoxFor(model => model.customer_name, null, new { @class = "form-control r-0 light s-12", id = "customer_name" })
                @Html.HiddenFor(model => model.customer_id, new { @id = "customer_id" })
                @Html.ValidationMessageFor(model => model.customer_name, null, new { @class = "alert-danger" })
            </div>


        </div>
        <div class="form-row mt-1">
            <div class="form-group col-4 m-0">
                @Html.LabelFor(model => model.date_of_arrival, new { @class = "Label" })
                @Html.TextBoxFor(model => model.date_of_arrival, "{0:dd-MMM-yyyy}", new { @class = "form-control r-0 light s-12 datepicker", id = "date_of_arrival" })
                @Html.ValidationMessageFor(model => model.date_of_arrival, null, new { @class = "alert-danger" })
            </div>
            <div class="form-group col-4 m-0">
                @Html.LabelFor(model => model.vehicle_no, new { @class = "Label" })
                @Html.TextBoxFor(model => model.vehicle_no, null, new { @class = "form-control r-0 light s-12", id = "vehicle_no", @readonly = "readonly" })
                @Html.ValidationMessageFor(model => model.vehicle_no, null, new { @class = "alert-danger" })
            </div>
        </div>
        <div class="form-row mt-1">
            <div class="form-group col-4 m-0">
                @Html.Label("Mode of Transpotation", new { @class = "Label" })
                <label class="btn btn-default">@Html.RadioButtonFor(model => model.mode_of_transportation, "Road")Road</label>
                <label class="btn btn-default">@Html.RadioButtonFor(model => model.mode_of_transportation, "Courier")Courier</label>

            </div>
            <div class="form-group col-4 m-0">
                <label class="btn btn-default">@Html.RadioButtonFor(model => model.mode_of_transportation, "Hand Carried By")Hand Carried By</label>
            </div>


        </div>
    </div>
    <div class="col-md-12">
        <div class="panel panel-default">
           
            <div class="panel-body">

                <div class="row" id="divCutomerTbl">
                    <div class="col-md-12">

                        <table class="table" id="">
                            <thead>
                                <tr>
                                    <th>PO</th>
                                    <th>Grade</th>
                                    <th>Section</th>
                                    <th>Order Qty</th>
                                    <th>Challan Qty</th>
                                    <th>Accepted Qty</th>
                                    <th>Rate/Per</th>
                                    <th>Shortfall</th>
                                    <th>Reason</th>
                                    <th>Heat Code</th>
                                    <th>Heat Number</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody id="tblCustomerPODetails" style="display:none;">
                                <tr>
                                    <td>
                                        <input type="text" name="POM" class="form-control r-0 light s-12  " id="POM" />
                                    </td>
                                    <td>
                                        <input type="text" name="GradeM" class="form-control r-0 light s-12" id="GradeM" />
                                    </td>
                                    <td>
                                        <input type="text" name="SectionM" class="form-control r-0 light s-12" id="SectionM" />
                                    </td>
                                    <td>
                                        <input type="text" name="OQtyM" class="form-control r-0 light s-12 " id="OQtyM" />
                                    </td>
                                    <td>
                                        <input type="text" name="CQtyM" class="form-control r-0 light s-12 " id="CQtyM" />
                                    </td>
                                    <td>
                                        <input type="text" name="AQtyM" class="form-control r-0 light s-12 " id="AQtyM" />
                                    </td>
                                    <td>
                                        @Html.DropDownList("RatePerM", @ViewBag.RatePer as IEnumerable<SelectListItem>, XRP.Global.DropDownSelection.DropDownSelect, new { @class = ".chzn-select form-control r-0 light s-12 ", id = "RatePerM" })
                                    </td>
                                    <td>
                                        <input type="text" name="ShortfallM" class="form-control r-0 light s-12 " id="ShortfallM" />
                                    </td>
                                    <td>
                                        <input type="text" name="ReasonM" class="form-control r-0 light s-12 " id="ReasonM" />
                                    </td>
                                    <td>
                                        <input type="text" name="HeatCodeM" class="form-control r-0 light s-12 " id="HeatCodeM" />
                                    </td>
                                    <td>
                                        <input type="text" name="HeatNumberM" class="form-control r-0 light s-12 " id="HeatNumberM" />
                                    </td>
                                    <td>
                                        <button type="button" id="btnAdd" class="btn-sm btn-primary classAdd"><i class="icon-remove"></i></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                    </div>
                </div>


                <div class="row" style="max-height:150px; overflow:scroll;" id="processing">
                    <div class="col-md-12">

                        <table class="table" id="maintable">

                            <tbody>
                                @foreach (var data in Model.ssmtbl_GoodsInward_DetailsModel)
                                {
                                    <tr class="data-contact-person">
                                        <td>
                                            <input type="text" name="ItemCodeM" class="form-control r-0 light s-12 l i_po01" id="ItemCodeM" value="@data.po" readonly="readonly" />
                                        </td>
                                        <td>
                                            <input type="text" name="ItemDescriptionM" class="form-control r-0 light s-12  i_grade01" id="ItemDescriptionM" readonly="readonly" value="@data.grade" />
                                        </td>
                                        <td>
                                            <input type="text" name="OQtyM" class="form-control r-0 light s-12  i_section01" id="OQtyM" value="@data.section" readonly="readonly" />
                                        </td>
                                        <td>
                                            <input type="text" name="OQtyM" class="form-control r-0 light s-12  o_qty01" id="OQtyM" value="@data.order_qty" readonly="readonly" />
                                        </td>
                                        <td>
                                            <input type="text" name="CQtyM" class="form-control r-0 light s-12  c_qty01" id="CQtyM" value="@data.challan_qty" />
                                        </td>
                                        <td>
                                            <input type="text" name="AQtyM" class="form-control r-0 light s-12  a_qty01" id="AQtyM" value="@data.accepted_qty" />
                                        </td>
                                        <td>
                                            <input type="text" name="RatePerM" class="form-control r-0 light s-12  rate_per01" id="RatePerM" value="@data.rate_per" readonly="readonly" />
                                        </td>
                                        <td>
                                            <input type="text" name="ShortfallM" class="form-control r-0 light s-12  short_fall01" id="ShortfallM" value="@data.shortfall" readonly="readonly" />
                                        </td>
                                        <td>
                                            <input type="text" name="ReasonM" class="form-control r-0 light s-12  reason01" id="ReasonM" value="@data.reason" readonly="readonly" />
                                        </td>
                                        <td>
                                            <input type="text" name="ReasonM" class="form-control r-0 light s-12  heat_code01" id="ReasonM" value="@data.heat_code" readonly="readonly" />
                                        </td>
                                        <td>
                                            <input type="text" name="ReasonM" class="form-control r-0 light s-12  heat_number01" id="ReasonM" value="@data.heat_number" readonly="readonly" />
                                        </td>
                                        <td>
                                            <button type="button" id="btnDelete" class="deleteContact   btn-danger btn-sm" onclick="Remove(this);"><i class="icon-remove"></i></button>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>

                    </div>

                </div>

            </div>
        </div>
    </div>



        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                  
                    <div class="panel-body">
                        <div class="col-md-6">
                            <div class="form-group">
                                <table class="table table-hover">
                                    <tbody>
                                        @for (int i = 0; i < Model.ssmtbl_GoodsInward_DocReceivedModel.Count; i++)
                                        {
                                            <tr class="data-doc-received">
                                                <td>
                                                    <label class="btn btn-default" style="width:100%; text-align:left">
                                                        @Html.CheckBoxFor(m => Model.ssmtbl_GoodsInward_DocReceivedModel[i].ischecked, new { @class = "btn btn-default ischecked" })
                                                        @Model.ssmtbl_GoodsInward_DocReceivedModel[i].doc_name
                                                    </label>
                                                    @Html.HiddenFor(m => Model.ssmtbl_GoodsInward_DocReceivedModel[i].doc_id, new { @class = "doc_id" })
                                                    @Html.HiddenFor(m => Model.ssmtbl_GoodsInward_DocReceivedModel[i].doc_name, new { @class = "doc_name" })
                                                </td>
                                            </tr>
                                        }

                                    </tbody>
                                </table>
                            </div>
                        </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="form-row mt-1">
                    <div class="form-group col-4 m-0">
                        @Html.LabelFor(model => model.if_no_specify, new { @class = "Label" })
                        @Html.TextAreaFor(model => model.if_no_specify, new { @class = "form-control r-0 light s-12", id = "if_no_specify" })
                        @Html.ValidationMessageFor(model => model.if_no_specify, null, new { @class = "alert-danger" })
                    </div>
                    <div class="form-group col-4 m-0">
                        @Html.LabelFor(model => model.comment, new { @class = "Label" })
                        @Html.TextAreaFor(model => model.comment, new { @class = "form-control r-0 light s-12", id = "comment" })
                        @Html.ValidationMessageFor(model => model.comment, null, new { @class = "alert-danger" })
                    </div>
                    <div class="form-group col-4 m-0">

                    </div>

                </div>
            </div>
                        <div class="card-body" align="right">


                            <button type="button" name="Save" value="Update" class="btn btn-primary btn-sm" id="btnSubmit"><i class="icon-update">Update</i></button>

                        </div>






                        <script type="text/javascript" src="~/Scripts/jquery-1.10.2.js"></script>

                        <script src="~/Scripts/jquery-1.10.2.min.js"></script>

                        <script src="~/Content/Validations/JqueryUi.js"></script>
                        <script>
        var $j = jQuery.noConflict(true);

        $j(document).ready(function () {



            $j(document).on("click", ".classAdd", function () { //

                var POM = $j('#POM').val();
                var GradeM = $j('#GradeM').val();
                var SectionM = $j('#SectionM').val();
                var OQtyM = $j('#OQtyM').val();
                var CQtyM = $j('#CQtyM').val();
                var AQtyM = $j('#AQtyM').val();
                var RatePerM = $j('#RatePerM').val();
                var ShortfallM = $j('#ShortfallM').val();
                var ReasonM = $j('#ReasonM').val();
                var HeatCodeM = $j('#HeatCodeM').val();
                var HeatNumberM = $j('#HeatNumberM').val();

                //alert(store_id);

                var rowCount = $j('.data-contact-person').length + 1;
                //var contactdiv = $('.data-contact-person');
                var contactdiv = '<tr class="data-contact-person">' +
                    '<td><input type="text" name="POM' + rowCount + '" class="form-control POM01" value="' + POM + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="GradeM' + rowCount + '" class="form-control GradeM01" value="' + GradeM + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="SectionM' + rowCount + '" class="form-control SectionM01" value="' + SectionM + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="OQtyM' + rowCount + '" class="form-control OQtyMM01" value="' + OQtyM + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="CQtyM' + rowCount + '" class="form-control CQtyM01" value="' + CQtyM + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="AQtyM' + rowCount + '" class="form-control AQtyM01" value="' + AQtyM + '" readonly="readonly"/></td>' +

                    '<td><input type="text" name="RatePerM' + rowCount + '" class="form-control RatePerM01" value="' + RatePerM + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="ShortfallM' + rowCount + '" class="form-control ShortfallM01" value="' + ShortfallM + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="ReasonM' + rowCount + '" class="form-control ReasonM01" value="' + ReasonM + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="HeatCodeM' + rowCount + '" class="form-control HeatCodeM01" value="' + HeatCodeM + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="HeatNumberM' + rowCount + '" class="form-control HeatNumberM01" value="' + HeatNumberM + '" readonly="readonly"/></td>' +

                    '<td><button type="button" id="btnDelete" class="deleteContact btn btn btn-danger btn-xs" onclick="Remove(this);"><span class="fa fa-arrows-h"></span></button></td>' +
                    '</tr>';
                //alert(contactdiv);
                $j('#maintable').append(contactdiv); // Adding these controls to Main table class
                // Clear Main Text Boxes And Combo Box
                $j('#POM').val("");
                $j('#GradeM').val("");
                $j('#SectionM').val("");
                $j('#OQtyM').val("0");
                $j('#CQtyM').val("0");
                $j('#RatePerM').val("");
                $j('#ShortfallM').val("0");
                $j('#ReasonM').val("");
                $j('#HeatCodeM').val("");
                $j('#HeatNumberM').val("");
                $j('#AQtyM').val("0");
                $j('#POM').focus();
            });



            if ($j('input[name=received_from]').click(function () {
                var radiodata = $j('input[name=received_from]:checked').val();
                if (radiodata == "Customer") {
                            document.getElementById("vendor_name").readOnly = true;
                document.getElementById("customer_name").readOnly = false;
                document.getElementById("vendor_po_no").readOnly = true;
                $j("#vendor_name").val('');
                $j('#vendor_po_no').val('');

                $("#maintable").find("tr:not(:first)").remove();

                $j('#tblCustomerPODetails').show();

            }
            else {
                                document.getElementById("vendor_name").readOnly = false;
                document.getElementById("customer_name").readOnly = true;
                document.getElementById("vendor_po_no").readOnly = false;
                $j("#customer_name").val('');
                $j('#tblCustomerPODetails').hide();

            }
            }));



            if ($j('input[name=mode_of_transportation]').click(function () {
                var radiodata = $j('input[name=mode_of_transportation]:checked').val();
                if (radiodata == "Road") {
                            document.getElementById("vehicle_no").readOnly = false;
            }
            else {
                                document.getElementById("vehicle_no").readOnly = true;
                $j("#vehicle_no").val('');
            }
            }));





            $j("#vendor_name").autocomplete({
                source: function (request, response) {
                    var customer = new Array();
                    $j.ajax({
                        url: "../VendorPurchaseOrder/getVendorName",
                        type: "POST",
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data) {
                            response($j.map(data, function (item) {
                                return {
                                    label: item.Text,
                                    Id: item.Value
                                }
                            }));
                        }
                    });
                },
                minLength: 1,
                select: function (event, ui) {
                    $(this).val(ui.item.label);

                    $j.ajax({
                        url: "../VendorPurchaseOrder/getVendorDetails",
                        type: "POST",
                        dataType: "json",
                        data: { Id: ui.item.Id },
                        success: function (data) {
                            //console.log(data);
                            $j('#vendor_name').val(data.Name);
                        }
                    });


                }
            });


            // Grade Of Material
            $j("#GradeM").autocomplete({
                source: function (request, response) {
                    var customer = new Array();
                    $j.ajax({
                        url: "../GoodsInward/getMaterialGrade",
                        type: "POST",
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data) {
                            response($j.map(data, function (item) {
                                return {
                                    label: item.Text,
                                    Id: item.Value
                                }
                            }));
                        }
                    });
                },
                minLength: 1,
                select: function (event, ui) {
                    $j('#GradeM').val(ui.item.label);
                    $j('#GradeM').val(ui.item.Id);

                }
            });



            // Grade Of Material
            $j("#SectionM").autocomplete({
                source: function (request, response) {
                    var customer = new Array();
                    $j.ajax({
                        url: "../GoodsInward/getSection",
                        type: "POST",
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data) {
                            response($j.map(data, function (item) {
                                return {
                                    label: item.Text,
                                    Id: item.Value
                                }
                            }));
                        }
                    });
                },
                minLength: 1,
                select: function (event, ui) {
                    $j('#SectionM').val(ui.item.label);
                    $j('#SectionM').val(ui.item.Id);

                }
            });




            $j("#customer_name").autocomplete({
                source: function (request, response) {
                    var customer = new Array();
                    $j.ajax({
                        url: "../DeliveryChallan/getCustomernameandid",
                        type: "POST",
                        dataType: "json",
                        data: { Prefix: request.term },
                        success: function (data) {
                            response($j.map(data, function (item) {
                                return {
                                    label: item.Text,
                                    Id: item.Value
                                }
                            }));
                        }
                    });
                },
                minLength: 1,
                select: function (event, ui) {
                    //$(this).val(ui.item.label);

                    $j('#customer_name').val(ui.item.label);
                    $j('#customer_id').val(ui.item.Id);

                }
            });





            $j("#vendor_po_no").autocomplete({
                source: function (request, response) {
                    var customer = new Array();
                    var v_name = $j("#vendor_name").val();
                    var v_po_type = '@VendorPurchaseOrderType.RawMaterial';
                    $j.ajax({
                        url: "../GoodsInward/getVendorPONo",
                        type: "POST",
                        dataType: "json",
                        data: { vendor_name: v_name, Prefix: request.term, vpo_type: v_po_type },
                        success: function (data) {
                            response($j.map(data, function (item) {
                                return {
                                    label: item.Text,
                                    Id: item.Value

                                }
                            }));
                        }
                    });
                },
                minLength: 1,
                select: function (event, ui) {
                    $(this).val(ui.item.label);

                    $j.ajax({
                        url: "../GoodsInward/getVendorPONoDetails",
                        type: "POST",
                        dataType: "json",
                        data: { Id: ui.item.Id },
                        success: function (data) {
                            console.log(data);
                            $j('#vendor_po_no').val(data.po_no);

                            var tr;
                            //Append each row to html table
                            for (var i = 0; i < data.ssmtbl_VendorPurchaseOrder_DetailsModel.length; i++) {

                                var rowCount = $j('.data-contact-person').length + 1;
                                var contactdiv = '<tr class="data-contact-person">' +
                    '<td><input type="text" name="i_code' + rowCount + '" class="form-control i_po01" value="' + data.po_no + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="i_code' + rowCount + '" class="form-control i_grade01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].rm_gradeofmaterial + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="i_desc' + rowCount + '" class="form-control i_section01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].rm_section + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="o_qty' + rowCount + '" class="form-control o_qty01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].qty + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="c_qty' + rowCount + '" class="form-control c_qty01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].qty + '" /></td>' +
                    '<td><input type="text" name="a_qty' + rowCount + '" class="form-control a_qty01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].qty + '" /></td>' +
                    '<td><input type="text" name="rate_per' + rowCount + '" class="form-control rate_per01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].rate_per + '" readonly="readonly"/></td>' +
                    '<td><input type="text" name="short_fall' + rowCount + '" class="form-control short_fall01" value=0 /></td>' +
                    '<td><input type="text" name="reason' + rowCount + '" class="form-control reason01" value= ></td>' +
                    '<td><input type="text" name="heat_code' + rowCount + '" class="form-control heat_code01" value= ></td>' +
                    '<td><input type="text" name="heat_number' + rowCount + '" class="form-control heat_number01" value= ></td>' +

                    '</tr>';
                                $j('#maintable').append(contactdiv); // Adding these controls to Main table class
                            }

                        }
                    });


                }
            });


            function myfunction() {
                debugger;
                $j.ajax({
                    url: "../GoodsInward/getVendorPONoDetails",
                    type: "POST",
                    dataType: "json",
                    data: { Id: $j('#vendor_po_no').val() },
                    success: function (data) {
                        console.log(data);
                        $j('#vendor_po_no').val(data.po_no);

                        var tr;
                        //Append each row to html table
                        for (var i = 0; i < data.ssmtbl_VendorPurchaseOrder_DetailsModel.length; i++) {

                            var rowCount = $j('.data-contact-person').length + 1;
                            var contactdiv = '<tr class="data-contact-person">' +
                '<td><input type="text" name="i_code' + rowCount + '" class="form-control i_po01" value="' + data.po_no + '" readonly="readonly"/></td>' +
                '<td><input type="text" name="i_code' + rowCount + '" class="form-control i_grade01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].rm_gradeofmaterial + '" readonly="readonly"/></td>' +
                '<td><input type="text" name="i_desc' + rowCount + '" class="form-control i_section01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].rm_section + '" readonly="readonly"/></td>' +
                '<td><input type="text" name="o_qty' + rowCount + '" class="form-control o_qty01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].qty + '" readonly="readonly"/></td>' +
                '<td><input type="text" name="c_qty' + rowCount + '" class="form-control c_qty01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].qty + '" /></td>' +
                '<td><input type="text" name="a_qty' + rowCount + '" class="form-control a_qty01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].qty + '" /></td>' +
                '<td><input type="text" name="rate_per' + rowCount + '" class="form-control rate_per01" value="' + data.ssmtbl_VendorPurchaseOrder_DetailsModel[i].rate_per + '" readonly="readonly"/></td>' +
                '<td><input type="text" name="short_fall' + rowCount + '" class="form-control short_fall01" value=0 /></td>' +
                '<td><input type="text" name="reason' + rowCount + '" class="form-control reason01" value= ></td>' +
                '<td><input type="text" name="heat_code' + rowCount + '" class="form-control heat_code01" value= ></td>' +
                '<td><input type="text" name="heat_number' + rowCount + '" class="form-control heat_number01" value= ></td>' +

                '</tr>';
                            $j('#maintable').append(contactdiv); // Adding these controls to Main table class
                        }

                    }
                });
            }

            //myfunction();


            $j("#POM").autocomplete({
                source: function (request, response) {
                    var customer = new Array();
                    var c_name = $j("#customer_name").val();
                    $j.ajax({
                        url: "../GoodsInward/getCustomerPONo",
                        type: "POST",
                        dataType: "json",
                        data: { customerName: c_name, Prefix: request.term },
                        success: function (data) {
                            response($j.map(data, function (item) {
                                return {
                                    label: item.Text,
                                    Id: item.Value
                                }
                            }));
                        }
                    });
                },
                minLength: 1,
                select: function (event, ui) {
                    $(this).val(ui.item.label);

                    $j.ajax({
                        url: "../GoodsInward/getCustomerPONoDetails",
                        type: "POST",
                        dataType: "json",
                        data: { Id: ui.item.Id },
                        success: function (data) {
                            console.log(data);
                            if (data.POQty_Open == false) {
                                $j('#OQtyM').val(data.QtymentionedinPO);
                                $j('#AQtyM').val(data.QtymentionedinPO);
                                $j('#CQtyM').val(data.QtymentionedinPO);
                            }
                            var tr;

                        }
                    });


                }
            });

        });






        function getAllGIData() {
            var data = [];

            var alldata = {
                'gin_char': $j('#gin_char').val(),
                'gin_id': $j('#gin_id').val(),
                'inward_type': $j('#inward_type').val(),
                'gin_number': $j('#gin_number').val(),
                'vendor_name': $j('#vendor_name').val(),
                'vendor_id': $j('#vendor_id').val(),
                'customer_name': $j('#customer_name').val(),
                'customer_id': $j('#customer_id').val(),
                'date_of_arrival': $j('#date_of_arrival').val(),
                'vendor_po_no': $j('#vendor_po_no').val(),
                'gate_entry_no': $j('#gate_entry_no').val(),
                'last_gate_entry_no': $j('#last_gate_entry_no').val(),
                'challan_no': $j('#challan_no').val(),
                'mode_of_transportation': $j('input[name=mode_of_transportation]:checked').val(),
                'vehicle_no': $j('#vehicle_no').val(),
                'comment': $j('#comment').val(),

                'if_no_specify': $j('#if_no_specify').val(),
                'mill_tc_path': $j('#mill_tc_path').val(),
                'received_from': $j('input[name=received_from]:checked').val()

            }
            return alldata;
        }


        function getAllGIDetailsData() {
            var data = [];

            var radiodata = $j('input[name=received_from]:checked').val();
            if (radiodata == "Customer") {
                $j('tr.data-contact-person').each(function () {
                    //alert('m');
                    var po = $j(this).find('.POM01').val();
                    var grade = $j(this).find('.GradeM01').val();
                    var section = $j(this).find('.SectionM01').val();
                    var heat_code = $j(this).find('.HeatCodeM01').val();
                    var heat_number = $j(this).find('.HeatNumberM01').val();
                    var rate_per = $j(this).find('.RatePerM01').val();
                    var short_fall = $j(this).find('.ShortfallM01').val();
                    var reason = $j(this).find('.ReasonM01').val();
                    var o_qty = $j(this).find('.OQtyMM01').val();
                    var c_qty = $j(this).find('.CQtyMM01').val();
                    var a_qty = $j(this).find('.AQtyMM01').val();

                    if (!isNaN(short_fall) && short_fall > 0) {
                    }
                    else {
                        short_fall = '0';
                    }

                    var alldata = {
                        'po': po,
                        'grade': grade,
                        'section': section,
                        'heat_code': heat_code,
                        'heat_number': heat_number,
                        'order_qty': o_qty,
                        'challan_qty': c_qty,
                        'accepted_qty': a_qty,
                        'rate_per': rate_per,
                        'shortfall': short_fall,
                        'reason': reason
                    }
                    data.push(alldata);
                });
            }
            else {
                $j('tr.data-contact-person').each(function () {
                    //alert('m');
                    var po = $j(this).find('.i_po01').val();
                    var grade = $j(this).find('.i_grade01').val();
                    var section = $j(this).find('.i_section01').val();
                    var heat_code = $j(this).find('.heat_code01').val();
                    var heat_number = $j(this).find('.heat_number01').val();
                    var rate_per = $j(this).find('.rate_per01').val();
                    var short_fall = $j(this).find('.short_fall01').val();
                    var reason = $j(this).find('.reason01').val();
                    var o_qty = $j(this).find('.o_qty01').val();
                    var c_qty = $j(this).find('.c_qty01').val();
                    var a_qty = $j(this).find('.a_qty01').val();

                    if (!isNaN(short_fall) && short_fall > 0) {
                    }
                    else {
                        short_fall = '0';
                    }

                    var alldata = {
                        'po': po,
                        'grade': grade,
                        'section': section,
                        'heat_code': heat_code,
                        'heat_number': heat_number,
                        'order_qty': o_qty,
                        'challan_qty': c_qty,
                        'accepted_qty': a_qty,
                        'rate_per': rate_per,
                        'shortfall': short_fall,
                        'reason': reason
                    }
                    data.push(alldata);
                });
            }



            //console.log(data);//
            return data;
        }


        function getAllGIDocReceivedData() {
            var data = [];
            $j('tr.data-doc-received').each(function () {
                //alert('m');
                var i_ischecked = false;

                if ($j(this).find('.ischecked').prop("checked") == true) {
                    i_ischecked = true;
                }

                var i_doc_id = $j(this).find('.doc_id').val();
                var o_doc_name = $j(this).find('.doc_name').val();
                var alldata = {
                    'doc_id': i_doc_id,
                    'doc_name': o_doc_name,
                    'ischecked': i_ischecked
                }
                data.push(alldata);
            });
            return data;
        }



        function Remove(button) {
            //Determine the reference of the Row using the Button.
            var row = $(button).closest("tr");
            var name = $("td", row).eq(0).html();
            if (confirm("Do you want to delete: ")) {

                //Get the reference of the Table.
                var table = $("#maintable")[0];

                //Delete the Table row using it's Index.
                table.deleteRow(row[0].rowIndex);

                getNetTotal();
            }
        };


        $("#btnSubmit").click(function (e) {


            if ($j('#gin_number').val()) {
                if ($j('#date_of_arrival').val()) {
                    if ($j('#gate_entry_no').val()) {
                        if ($j('#last_gate_entry_no').val()) {
                            if ($j('#challan_no').val()) {

                                var newgin_number = $j('#gin_number').val();
                                var newUrl = '@Url.Action("UpdateGIRawMaterial", "GoodsInward")?id=' + newgin_number + '&successmsg=updatesuccess';


                                var datas = JSON.stringify(getAllGIData());
                                var detailsdata = JSON.stringify(getAllGIDetailsData());
                                var datadocreceived = JSON.stringify(getAllGIDocReceivedData());

                                $j('#submitDiv').hide();
                                $j('#loaderDiv').show();
                                $.ajax({
                                    url: '@Url.Action("UpdateGIRawMaterial", "GoodsInward")',
                                    type: 'POST',
                                    data: JSON.stringify({ 'gidata': datas, 'gidetailsdata': detailsdata, 'gidocreceived': datadocreceived }),
                                    dataType: 'json',
                                    contentType: 'application/json; charset=utf-8',
                                    success: function (sdata) {
                                        if (sdata.result == "Goods Inward Updated Successfully!") {
                                            window.location.href = newUrl;
                                        }
                                        else {
                                            alert(sdata.result);
                                            $j('#submitDiv').show();
                                            $j('#loaderDiv').hide();
                                        }
                                    },
                                    error: function () {
                                        alert("Error while inserting data");
                                        $j('#submitDiv').show();
                                        $j('#loaderDiv').hide();
                                    }
                                });
                            }
                            else {
                                alert('Please enter Challan Number!');
                            }
                        }
                        else {
                            alert('Please enter Last Gate Entry Number!');
                        }
                    }
                    else {
                        alert('Please enter Gate Entry Number!');
                    }

                }
                else {
                    alert('Please enter Date Of Arrival!');
                }
            }
            else {
                alert('Please enter GIN Number.!');
            }


        });


                        </script>


                        }
